---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead title="Admin Panel" description="Manage content" />
    </head>
    <body>
        <Header />

        <main>
            <h1>Admin Panel â€” CRUD</h1>
<section class="app-form">
  <h2>Add New App</h2>

  <form id="createForm">
    <!-- App Name -->
    <label>
      App Name
      <input
        type="text"
        name="name"
        placeholder="Camsea"
        required
      />
    </label>

    <!-- Author -->
    <label>
      Author
      <input
        type="text"
        name="author"
        placeholder="Mitu Inc. Limited"
        required
      />
    </label>

    <!-- Short Description -->
    <label>
      Short Description
      <textarea
        name="short_description"
        placeholder="Connect globally through live video chat with verified friends"
        rows="3"
        required
      ></textarea>
    </label>

    <!-- App URL -->
    <label>
      App URL
      <input
        type="url"
        name="app_url"
        placeholder="https://camsea.en.uptodown.com/android"
        required
      />
    </label>

    <!-- Icon URL -->
    <label>
      Icon URL
      <input
        type="url"
        name="icon_url"
        placeholder="https://img.utdstc.com/icon/...etc"
        required
      />
    </label>

    <!-- Platform Name -->
    <label>
      Platform Name
      <input
        type="text"
        name="platform_name"
        placeholder="Android"
        required
      />
    </label>

    <!-- Platform URL -->
    <label>
      Platform URL
      <input
        type="text"
        name="platform_url"
        placeholder="/android"
        required
      />
    </label>

    <!-- Platform ID -->
    <label>
      Platform ID
      <input
        type="number"
        name="platform_id"
        placeholder="13"
        required
      />
    </label>

    <!-- App ID -->
    <label>
      App ID
      <input
        type="number"
        name="app_id"
        placeholder="1319636"
        required
      />
    </label>

    <!-- Promoted App -->
    <label>
      Promoted App (0 or 1)
      <input
        type="number"
        name="promoted_app"
        placeholder="0"
        min="0"
        max="1"
        required
      />
    </label>

    <button type="submit">Add App</button>
  </form>
</section>

<style>
  .app-form {
    margin: 2rem 0;
    padding: 1.5rem;
    background: #f7f7f7;
    border-radius: 10px;
  }

  .app-form form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .app-form label {
    display: flex;
    flex-direction: column;
    font-weight: 500;
  }

  .app-form input,
  .app-form textarea {
    padding: 0.6rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 1rem;
  }

  .app-form button {
    padding: 0.7rem;
    background: #4f46e5;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }

  .app-form button:hover {
    background: #4338ca;
  }
</style>


            <section>
                <h2>All Posts</h2>
                <div id="posts"></div>
            </section>
        </main>

        <Footer />

        <script>
            async function loadPosts() {
                const res = await fetch("/api/posts.json");
                const posts = await res.json();
                console.log(posts)

                document.getElementById("posts").innerHTML = posts
                    .map(
                        (p) => `
        <div style="border:1px solid #ccc; padding:10px; margin:10px 0;">
        <img src=${p.icon_url}></img>
          <h3>${p.name}</h3>
          <p>${p.short_description}</p>

          <button onclick="editPost(${p.id}, '${p.title}', \`${p.content}\`)">Edit</button>
          <button onclick="deletePost(${p.id})">Delete</button>
        </div>
      `,
                    )
                    .join("");
            }

            document.getElementById("createForm").onsubmit = async (e) => {
                e.preventDefault();
                const form = new FormData(e.target);

                await fetch("/api/create", {
                    method: "POST",
                    body: JSON.stringify({
                        title: form.get("title"),
                        content: form.get("content"),
                    }),
                });

                e.target.reset();
                loadPosts();
            };

            window.editPost = (id, title, content) => {
                const newTitle = prompt("Edit title:", title);
                const newContent = prompt("Edit content:", content);

                if (newTitle && newContent) {
                    fetch("/api/update", {
                        method: "POST",
                        body: JSON.stringify({
                            id,
                            title: newTitle,
                            content: newContent,
                        }),
                    }).then(loadPosts);
                }
            };

            window.deletePost = (id) => {
                if (confirm("Delete this post?")) {
                    fetch("/api/delete", {
                        method: "POST",
                        body: JSON.stringify({ id }),
                    }).then(loadPosts);
                }
            };

            loadPosts();
        </script>
    </body>
</html>
